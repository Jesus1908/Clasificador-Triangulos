<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clasificador de Tri√°ngulos</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>

  <style>
    body {
      background-color: antiquewhite;
      font-family: sans-serif;
      text-align: center;
    }

    canvas {
      border: 2px solid #333;
      margin-top: 10px;
    }

    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }

    .casillas {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .casilla {
      border: 2px solid #999;
      padding: 10px;
      border-radius: 10px;
      background-color: white;
      transition: background-color 0.3s ease;
      width: 140px;
    }

    .casilla.activa {
      background-color: #a8e6a3;
      border-color: #4caf50;
    }

    .casilla img {
      width: 100px;
      height: auto;
    }

    .casilla p {
      margin: 5px 0 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Clasificador de Tri√°ngulos</h2>
  
  <div class="casillas">
    <div id="rectanguloa" class="casilla">
      <img src="images/rectanguloA.png" alt="Tri√°ngulo Rect√°ngulo A">
      <p>Rect√°ngulo A</p>
    </div>
    <div id="rectangulob" class="casilla">
      <img src="images/rectanguloB.png" alt="Tri√°ngulo Rect√°ngulo B">
      <p>Rect√°ngulo B</p>
    </div>
    <div id="rectanguloc" class="casilla">
      <img src="images/rectanguloC.png" alt="Tri√°ngulo Rect√°ngulo C">
      <p>Rect√°ngulo C</p>
    </div>
    <div id="rectangulod" class="casilla">
      <img src="images/rectanguloD.png" alt="Tri√°ngulo Rect√°ngulo D">
      <p>Rect√°ngulo D</p>
    </div>
    <div id="acutanguloa" class="casilla">
      <img src="images/acutanguloA.png" alt="Tri√°ngulo Acut√°ngulo A">
      <p>Acut√°ngulo A</p>
    </div>
    <div id="acutangulob" class="casilla">
      <img src="images/acutanguloB.png" alt="Tri√°ngulo Acut√°ngulo B">
      <p>Acut√°ngulo B</p>
    </div>
  </div>

  <script>
    let ShapeClassifier;
    let canvas;
    let resultDiv;
    let clearButton;
    let ultimaEtiqueta = "";

    function setup() {
      canvas = createCanvas(400, 400);
      background(255);

      let options = {
        inputs: [64, 64, 4],
        task: "imageClassification"
      };
      ShapeClassifier = ml5.neuralNetwork(options);

      const modelDetails = {
        model: 'model/model.json',
        metadata: 'model/model_meta.json',
        weights: 'model/model.weights.bin'
      };

      clearButton = createButton('üßπ Limpiar');
      clearButton.mousePressed(() => {
        background(255);
        quitarResaltado();
      });

      resultDiv = createDiv('Cargando el modelo...');
      ShapeClassifier.load(modelDetails, modelLoaded);
    }

    function modelLoaded() {
      console.log("‚úÖ Modelo cargado correctamente");
      resultDiv.html('Modelo cargado. Dibuja un tri√°ngulo para clasificar.');
      classifyImage();
    }

    function classifyImage() {
      let img = get();
      img.resize(64, 64);
      ShapeClassifier.classify({ image: img }, gotResults);
    }

    function gotResults(err, results) {
      if (err) {
        console.error(err);
        return;
      }

      if (results && results[0]) {
        let etiqueta = results[0].label.toLowerCase(); 
        let confianza = nf(results[0].confidence, 0, 2);
        resultDiv.html(`üß† Etiqueta: <strong>${etiqueta}</strong><br>Confianza: <strong>${confianza}</strong>`);

        if (etiqueta !== ultimaEtiqueta) {
          ultimaEtiqueta = etiqueta;
          decir(`Este tri√°ngulo es un ${etiqueta.replace(/([a-z])([A-Z])/g, '$1 $2')}`);
          resaltarCasilla(etiqueta);
        }
      } else {
        resultDiv.html("No se pudo clasificar.");
      }

      setTimeout(classifyImage, 1000);
    }

    function resaltarCasilla(etiqueta) {
      quitarResaltado();
      const casilla = document.getElementById(etiqueta);
      if (casilla) {
        casilla.classList.add("activa");
      }
    }

    function quitarResaltado() {
      const ids = [
        "rectanguloa", "rectangulob", "rectanguloc", "rectangulod",
        "acutanguloa", "acutangulob"
      ];
      ids.forEach(id => {
        document.getElementById(id).classList.remove("activa");
      });
    }

    function decir(texto) {
      const speech = new SpeechSynthesisUtterance();
      speech.lang = "es-ES";
      speech.text = texto;
      window.speechSynthesis.speak(speech);
    }

    function draw() {
      if (mouseIsPressed) {
        strokeWeight(8);
        stroke(0);
        line(mouseX, mouseY, pmouseX, pmouseY);
      }
    }
  </script>
</body>
</html>
